<div class="header-text">
  <span>Publicaciones de interés</span>
</div>
<div class="barra-filtros">
  <ejs-textbox
    placeholder="Buscar alerta..."
    [(ngModel)]="filtroBusqueda"
  ></ejs-textbox>

  <ejs-dropdownlist
  [dataSource]="fuentes"
  [(ngModel)]="filtroFuente"
  placeholder="Fuente"
  [fields]="{ text: 'nombre', value: '_id' }"
>
  <ng-template #itemTemplate let-data>
    {{ data.nombre }}
  </ng-template>
</ejs-dropdownlist>

  <ejs-dropdownlist
  [dataSource]="areas"
  [(ngModel)]="filtroArea"
  (ngModelChange)="onAreaChange($event)"
  placeholder="Área"
  [fields]="{ text: 'nombre', value: '_id' }"
  ></ejs-dropdownlist>

  <ejs-dropdownlist
  [dataSource]="conceptos"
  [(ngModel)]="filtroConcepto"
  placeholder="Concepto"
  [fields]="{ text: 'nombre', value: '_id' }"
></ejs-dropdownlist>



  <div class="filtro-item">
  <ejs-dropdownlist
    id="tono"
    [dataSource]="valoraciones"
    [(ngModel)]="filtroValoracion"
        placeholder="Tono"
  ></ejs-dropdownlist>
</div>

  <ejs-datepicker
    [(ngModel)]="fechaDesde"
    placeholder="Desde"
  ></ejs-datepicker>

  <ejs-datepicker
    [(ngModel)]="fechaHasta"
    placeholder="Hasta"
  ></ejs-datepicker>

  <button class="boton-reset" (click)="aplicarFiltros()">Aplicar</button>
  <button class="boton-reset" (click)="resetFiltros()">Resetear</button>
</div>

<div class="contenedor-cards">
  <app-spinner *ngIf="loading" message="Cargando noticias..."></app-spinner>
  <div
    *ngFor="let alerta of alertasFiltradas"
    class="alerta-card"
    [ngStyle]="{ 'background-color': getColor(alerta.tono) }"
  >
    <div class="card-texto">
      <!-- Header -->
      <div class="fila-header">
        <div class="titulo">{{ alerta.titulo }}</div>
        <div class="fecha">{{ alerta.fecha | date : "short" }}</div>
      </div>

      <!-- Contenido colapsable [class.collapsed]="!isExpanded(alerta._id!)" -->
      <div class="resumen contenido" (click)="toggleExpand(alerta._id!)">
        {{ alerta.contenido }}
      </div>
      <!-- <button
        class="toggle-btn"
        (click)="toggleExpand(alerta._id!); $event.stopPropagation()"
      >
        {{ isExpanded(alerta._id!) ? "Mostrar menos" : "Mostrar más" }}
      </button> -->

      <!-- Footer -->
      <div class="fila-footer">
        <div class="fuente">
          <!--  TODO: Cambiar por el nombre de la fuente cuando se recupere desde back con join de alertas y fuentes
          <a [href]="alerta.url" target="_blank">{{ alerta.fuente }}</a> 
          -->
          <a [href]="alerta.url" target="_blank">{{ alerta.url }}</a>
        </div>
        <div class="fecha">Tono: {{ alerta.tono || "Sin calificar" }}</div>
      </div>
    </div>
  </div>
</div>
